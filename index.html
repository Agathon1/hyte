<head>
    <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>        
    <title>Hyte</title>
</head>

<body>
    <h1>Nothing to see here...</h1>
    <script>
    function base64ToBytes(base64) {
        const binString = atob(base64);
        return Uint8Array.from(binString, (m) => m.codePointAt(0));
    }

    if(window.location.hash) {
        let hash = window.location.hash.substring(1).split("&")[0];

        console.log(hash);
        
        let base64_as_bytes = base64ToBytes(hash);

        console.log(base64_as_bytes);

        let decompressed = pako.inflate(base64_as_bytes);

        console.log(decompressed);

        let htmlString = new TextDecoder().decode(decompressed);
        
        console.log(htmlString);

        // Parse the HTML string into a Document object
        let parser = new DOMParser();
        let doc = parser.parseFromString(htmlString, 'text/html');

        // Get the head HTML (excluding <script> and <style> tags)
        let headHTML = doc.head.innerHTML;

        // Replace the entire document's head and body with parsed document's head and body.
        // The attributes of the body tag are also preserved.
        document.head.innerHTML = headHTML;
        document.body.outerHTML = doc.body.outerHTML;

        // Get the JavaScript code within <script> tags
        let scripts = Array.from(doc.getElementsByTagName('script')).map(script => script.textContent);

        // Get the CSS code within <style> tags
        let styles = Array.from(doc.getElementsByTagName('style')).map(style => style.textContent);

        // Add the CSS to the document
        let style = document.createElement('style');
        style.textContent = styles.join("\n");
        document.head.appendChild(style);

        // Add the JavaScript to the document
        // Add the JavaScript to the document
        Array.from(doc.getElementsByTagName('script')).forEach((originalScript, index) => {
            let script = document.createElement('script');
        
            if (originalScript.src) {
                // For scripts with a src attribute, set the new script's src to the same value
                script.src = originalScript.src;
                // Add the defer attribute to ensure scripts execute in order
                //script.defer = true;
            } else {
                // For inline scripts, copy over the textContent
                script.textContent = originalScript.textContent;
                if(originalScript.type === "module") {
                    script.type = "module";
                }
            }
        
            document.body.appendChild(script);
        });

    }
</script>


</body>
